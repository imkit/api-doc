# Assign Token

Generate tokens yourself and assign them to IMKIT Chat Server for use.

## Overview

Generate and validate user tokens yourself, while IMKIT only handles message processing. This mode is suitable for applications that have existing authentication systems and want complete control over the token lifecycle.

## Implementation Flow

1. Generate custom tokens in your system
2. Create a Client using `/admin/clients` API, passing in your provided token and expirationDate
3. Subsequently update or revoke tokens through API
4. Your system is responsible for token validation logic

------

## API Endpoint

### Create User and Assign External Token

Create a new user and assign an access token generated by your system.

```http
POST /admin/clients
```

#### Headers

| Parameter      | Type   | Required | Description        |
| -------------- | ------ | -------- | ------------------ |
| `IM-API-KEY`   | string | ✅       | Your API key       |
| `Content-Type` | string | ✅       | `application/json` |

#### Request Body

| Parameter          | Type    | Required | Description                      |
| ------------------ | ------- | -------- | -------------------------------- |
| `_id`              | string  | ✅       | User unique identifier           |
| `nickname`         | string  | ✅       | User display name                |
| `avatarUrl`        | string  | ❌       | User avatar URL                  |
| `issueAccessToken` | boolean | ✅       | Set to `false` to enable this authorization mode |
| `token`            | string  | ✅       | Custom token generated by your system |
| `expirationDate`   | string  | ✅       | Token expiration time (ISO 8601 format) |

#### Example Request

```json
{
  "_id": "user002",
  "nickname": "John",
  "avatarUrl": "https://example.com/avatar.jpg",
  "issueAccessToken": false,
  "token": "my-custom-token-xyz",
  "expirationDate": "2025-06-30T12:00:00Z"
}
```

#### Response

**Success Response (200 OK)**

| Parameter          | Type    | Description                                       |
| ------------------ | ------- | ------------------------------------------------- |
| `_id`              | string  | User unique identifier                            |
| `nickname`         | string  | User display name                                 |
| `avatarUrl`        | string  | User avatar URL                                   |
| `issueAccessToken` | boolean | Token issue mode (false means using external token) |
| `token`            | string  | Your provided custom token                        |
| `expirationDate`   | string  | Token expiration time (ISO 8601 format)          |

#### Example Response

```json
{
  "_id": "user002",
  "nickname": "John",
  "avatarUrl": "https://example.com/avatar.jpg",
  "issueAccessToken": false,
  "token": "my-custom-token-xyz",
  "expirationDate": "2025-06-30T12:00:00Z"
}
```

#### Error Response

**400 Bad Request** - Request parameter error

```json
{
  "error": "INVALID_REQUEST",
  "message": "Missing required field: token"
}
```

**401 Unauthorized** - Invalid API key

```json
{
  "error": "UNAUTHORIZED",
  "message": "Invalid API key"
}
```

**409 Conflict** - User already exists

```json
{
  "error": "USER_EXISTS",
  "message": "User with _id 'user002' already exists"
}
```

------

## Token Management

### Update Token

Update the external token for an existing user.

```http
PUT /admin/clients/{user_id}/token
```

#### Request Body

```json
{
  "token": "new-custom-token-abc",
  "expirationDate": "2025-12-31T23:59:59Z"
}
```

### Revoke Token

Revoke a user's access token, making them unable to continue using the chat service.

```http
DELETE /admin/clients/{user_id}/token
```

------

## Using Token

Use your custom token for API calls:

```http
Authorization: Bearer my-custom-token-xyz
```

## Notes

- **Token Validation Responsibility**: Your system needs to handle token validity verification
- **Expiration Time Management**: Ensure `expirationDate` matches the token expiration time in your system
- **Token Format**: IMKIT doesn't restrict token format, but recommends using JWT or similar standard formats
- **Security**: Ensure tokens have sufficient entropy and appropriate signing mechanisms
- **Update Frequency**: Recommend proactive token updates before expiration to avoid service interruption

## Integration Recommendations

1. **Unified Authentication**: Integrate IMKIT tokens with your existing authentication system
2. **Automatic Updates**: Implement automatic token update mechanisms to ensure service continuity
3. **Monitoring Mechanisms**: Monitor token usage status and expiration
4. **Error Handling**: Properly handle token expiration and invalid situations